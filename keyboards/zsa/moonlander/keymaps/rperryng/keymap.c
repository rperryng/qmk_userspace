/* Copyright 2020 ZSA Technology Labs, Inc <@zsa>
 * Copyright 2020 Jack Humbert <jack.humb@gmail.com>
 * Copyright 2020 Christopher Courtney, aka Drashna Jael're  (@drashna) <drashna@live.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */



#include QMK_KEYBOARD_H
#include "version.h"

#define LA_SYM MO(SYM)
#define LA_NAV MO(NAV)

enum layers {
    BASE,
    SYM,
    NAV,
    MOUS,
};

enum custom_keycodes {
    // callum oneshot mod implementation with no timers.
    OS_SHFT = SAFE_RANGE,
    OS_CTRL,
    OS_ALT,
    OS_CMD,
};

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
//    ┌────────┬─────┬─────┬─────┬─────┬─────┬─────┐                                       ┌─────┬─────┬─────┬─────┬──────────┬────────┬─────┐
//    │        │     │     │     │     │     │     │                                       │     │     │     │     │          │        │     │
//    ├────────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼──────────┼────────┼─────┤
//    │        │  j  │  l  │  u  │  y  │  ;  │     │                                       │     │  q  │  w  │  f  │    p     │   b    │     │
//    ├────────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼──────────┼────────┼─────┤
//    │        │  m  │  n  │  e  │  i  │  o  │     │                                       │     │  a  │  r  │  s  │    t     │   t    │     │
//    ├────────┼─────┼─────┼─────┼─────┼─────┼─────┘                                       └─────┼─────┼─────┼─────┼──────────┼────────┼─────┤
//    │        │  k  │  h  │  ,  │  .  │  /  │                                                   │  z  │  x  │  c  │    d     │   v    │     │
//    ├────────┼─────┼─────┼─────┼─────┼─────┘           ┌─────┐               ┌─────┐           └─────┼─────┼─────┼──────────┼────────┼─────┤
//    │ LA_SYM │ spc │     │     │     │                 │     │               │     │                 │     │     │ TO(MOUS) │ LA_NAV │     │
//    └────────┴─────┴─────┴─────┴─────┘           ┌─────┼─────┼─────┐   ┌─────┼─────┼─────┐           └─────┴─────┴──────────┴────────┴─────┘
//                                                 │     │     │     │   │     │     │     │
//                                                 └─────┴─────┴─────┘   └─────┴─────┴─────┘
[BASE] = LAYOUT(
  _______ , _______ , _______ , _______  , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______  , _______ , _______,
  _______ , KC_J    , KC_L    , KC_U     , KC_Y    , KC_SCLN , _______ ,                                                                 _______ , KC_Q    , KC_W    , KC_F    , KC_P     , KC_B    , _______,
  _______ , KC_M    , KC_N    , KC_E     , KC_I    , KC_O    , _______ ,                                                                 _______ , KC_A    , KC_R    , KC_S    , KC_T     , KC_T    , _______,
  _______ , KC_K    , KC_H    , KC_COMMA , KC_DOT  , KC_SLSH ,                                                                                     KC_Z    , KC_X    , KC_C    , KC_D     , KC_V    , _______,
  LA_SYM  , KC_SPC  , _______ , _______  , _______ ,                               _______ ,                         _______ ,                               _______ , _______ , TO(MOUS) , LA_NAV  , _______,
                                                                         _______ , _______ , _______ ,     _______ , _______ , _______
),

//    ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐                                       ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┘                                       └─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │                                                   │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┘           ┌─────┐               ┌─────┐           └─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │                 │     │               │     │                 │     │     │     │     │     │
//    └─────┴─────┴─────┴─────┴─────┘           ┌─────┼─────┼─────┐   ┌─────┼─────┼─────┐           └─────┴─────┴─────┴─────┴─────┘
//                                              │     │     │     │   │     │     │     │
//                                              └─────┴─────┴─────┘   └─────┴─────┴─────┘
[SYM] = LAYOUT(
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ ,                                                                                     _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ ,                               _______ ,                         _______ ,                               _______ , _______ , _______ , _______ , _______,
                                                                        _______ , _______ , _______ ,     _______ , _______ , _______
),

//    ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐                                       ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┘                                       └─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │                                                   │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┘           ┌─────┐               ┌─────┐           └─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │                 │     │               │     │                 │     │     │     │     │     │
//    └─────┴─────┴─────┴─────┴─────┘           ┌─────┼─────┼─────┐   ┌─────┼─────┼─────┐           └─────┴─────┴─────┴─────┴─────┘
//                                              │     │     │     │   │     │     │     │
//                                              └─────┴─────┴─────┘   └─────┴─────┴─────┘
[NAV] = LAYOUT(
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ ,                                                                                     _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ ,                               _______ ,                         _______ ,                               _______ , _______ , _______ , _______ , _______,
                                                                        _______ , _______ , _______ ,     _______ , _______ , _______
),

//    ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐                                       ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤                                       ├─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │     │                                       │     │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┼─────┘                                       └─────┼─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │     │                                                   │     │     │     │     │     │     │
//    ├─────┼─────┼─────┼─────┼─────┼─────┘           ┌─────┐               ┌─────┐           └─────┼─────┼─────┼─────┼─────┼─────┤
//    │     │     │     │     │     │                 │     │               │     │                 │     │     │     │     │     │
//    └─────┴─────┴─────┴─────┴─────┘           ┌─────┼─────┼─────┐   ┌─────┼─────┼─────┐           └─────┴─────┴─────┴─────┴─────┘
//                                              │     │     │     │   │     │     │     │
//                                              └─────┴─────┴─────┘   └─────┴─────┴─────┘
[MOUS] = LAYOUT(
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ , _______ ,                                                                 _______ , _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ , _______ ,                                                                                     _______ , _______ , _______ , _______ , _______ , _______,
  _______ , _______ , _______ , _______ , _______ ,                               _______ ,                         _______ ,                               _______ , _______ , _______ , _______ , _______,
                                                                        _______ , _______ , _______ ,     _______ , _______ , _______
)
};

bool is_oneshot_ignored_key(uint16_t keycode) {
    switch (keycode) {
    case LA_SYM:
    case LA_NAV:
    case KC_LSFT:
    case OS_SHFT:
    case OS_CTRL:
    case OS_ALT:
    case OS_CMD:
        return true;
    default:
        return false;
    }
}

oneshot_state os_shft_state = os_up_unqueued;
oneshot_state os_ctrl_state = os_up_unqueued;
oneshot_state os_alt_state = os_up_unqueued;
oneshot_state os_cmd_state = os_up_unqueued;

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    update_oneshot(
        &os_shft_state, KC_LSFT, OS_SHFT,
        keycode, record
    );
    update_oneshot(
        &os_ctrl_state, KC_LCTL, OS_CTRL,
        keycode, record
    );
    update_oneshot(
        &os_alt_state, KC_LALT, OS_ALT,
        keycode, record
    );
    update_oneshot(
        &os_cmd_state, KC_LCMD, OS_CMD,
        keycode, record
    );

    return true;
}

layer_state_t layer_state_set_user(layer_state_t state) {
    return update_tri_layer_state(state, SYM, NAV, MOUS);
}
